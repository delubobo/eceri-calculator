<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECERI Risk Calculator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --construction-blue: #003DA5;
            --construction-orange: #FF8200;
            --warning-yellow: #FFCC00;
            --text-gray: #333333;
            --light-blue: #C4D8E2;
        }
        
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            color: var(--text-gray);
            background-color: #f5f8fa;
        }
        
        .header {
            background-color: var(--construction-blue);
            color: white;
        }
        
        .btn-primary {
            background-color: var(--construction-orange);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #e67300;
        }
        
        .input-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .result-container {
            background-color: var(--light-blue);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .risk-negligible { background-color: #2ca02c; color: white; }
        .risk-low { background-color: #98df8a; color: var(--text-gray); }
        .risk-medium { background-color: #ffbb78; color: var(--text-gray); }
        .risk-high { background-color: #ff7f0e; color: white; }
        .risk-very-high { background-color: #d62728; color: white; }
        
        .gauge-container {
            position: relative;
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .gauge-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease-out;
        }
        
        .factor-contribution {
            height: 12px;
            margin: 2px 0;
            border-radius: 6px;
        }
        
        .height-factor { background-color: #4285F4; }
        .surface-factor { background-color: #FBBC05; }
        .slope-factor { background-color: #34A853; }
        .edge-factor { background-color: #EA4335; }
    </style>
</head>
<body>
    <div class="header py-4 px-4 mb-6">
        <div class="container mx-auto text-center">
            <h1 class="text-3xl font-bold">ECERI Risk Calculator</h1>
            <p class="text-xl">Elevated Construction Ergonomic Risk Index</p>
        </div>
    </div>

    <div class="container mx-auto px-4 pb-8">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="input-container p-6">
                <h2 class="text-2xl font-bold mb-4 text-center">Input Parameters</h2>
                
                <div class="mb-4">
                    <label class="block mb-2 font-semibold" for="reba">REBA Score (1-15):</label>
                    <input type="range" id="reba" name="reba" min="1" max="15" value="7" class="w-full">
                    <div class="flex justify-between">
                        <span>1</span>
                        <span id="rebaValue">7</span>
                        <span>15</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-2 font-semibold" for="height">Height (meters):</label>
                    <input type="range" id="height" name="height" min="0" max="30" value="10" step="0.5" class="w-full">
                    <div class="flex justify-between">
                        <span>0m</span>
                        <span id="heightValue">10m</span>
                        <span>30m</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-2 font-semibold" for="surface">Surface Condition (0-3):</label>
                    <div class="grid grid-cols-4 gap-2 mt-2">
                        <div class="text-center">
                            <input type="radio" id="surface0" name="surface" value="0" checked>
                            <label for="surface0" class="block mt-1">0<br><span class="text-xs">Optimal</span></label>
                        </div>
                        <div class="text-center">
                            <input type="radio" id="surface1" name="surface" value="1">
                            <label for="surface1" class="block mt-1">1<br><span class="text-xs">Moderate</span></label>
                        </div>
                        <div class="text-center">
                            <input type="radio" id="surface2" name="surface" value="2">
                            <label for="surface2" class="block mt-1">2<br><span class="text-xs">Challenging</span></label>
                        </div>
                        <div class="text-center">
                            <input type="radio" id="surface3" name="surface" value="3">
                            <label for="surface3" class="block mt-1">3<br><span class="text-xs">Hazardous</span></label>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block mb-2 font-semibold" for="slope">Slope Angle (degrees):</label>
                    <input type="range" id="slope" name="slope" min="0" max="45" value="15" class="w-full">
                    <div class="flex justify-between">
                        <span>0°</span>
                        <span id="slopeValue">15°</span>
                        <span>45°</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block mb-2 font-semibold" for="edgeDist">Edge Distance (meters):</label>
                    <input type="range" id="edgeDist" name="edgeDist" min="0.1" max="3" value="1.5" step="0.1" class="w-full">
                    <div class="flex justify-between">
                        <span>0.1m</span>
                        <span id="edgeDistValue">1.5m</span>
                        <span>3m</span>
                    </div>
                </div>
                
                <button id="calculate" class="btn-primary font-bold py-2 px-4 rounded w-full">
                    Calculate ECERI
                </button>
            </div>
            
            <!-- Results Section -->
            <div class="result-container p-6">
                <h2 class="text-2xl font-bold mb-4 text-center">Results</h2>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white p-4 rounded shadow text-center">
                        <h3 class="text-lg font-semibold">REBA Score</h3>
                        <p id="rebaScore" class="text-4xl font-bold mt-2">-</p>
                        <p id="rebaCategory" class="text-lg mt-1">-</p>
                    </div>
                    <div class="bg-white p-4 rounded shadow text-center">
                        <h3 class="text-lg font-semibold">ECERI Score</h3>
                        <p id="eceriScore" class="text-4xl font-bold mt-2">-</p>
                        <p id="eceriCategory" class="text-lg mt-1">-</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Amplification Factor</h3>
                    <div class="gauge-container">
                        <div id="amplificationGauge" class="gauge-fill" style="width: 0%; background-color: var(--construction-orange);"></div>
                    </div>
                    <p id="amplificationValue" class="text-center">0%</p>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Factor Contributions</h3>
                    <div class="bg-white p-3 rounded shadow">
                        <div class="mb-2">
                            <div class="flex justify-between mb-1">
                                <span>Height Factor</span>
                                <span id="heightContrib">0%</span>
                            </div>
                            <div id="heightBar" class="factor-contribution height-factor" style="width: 0%"></div>
                        </div>
                        <div class="mb-2">
                            <div class="flex justify-between mb-1">
                                <span>Surface Factor</span>
                                <span id="surfaceContrib">0%</span>
                            </div>
                            <div id="surfaceBar" class="factor-contribution surface-factor" style="width: 0%"></div>
                        </div>
                        <div class="mb-2">
                            <div class="flex justify-between mb-1">
                                <span>Slope Factor</span>
                                <span id="slopeContrib">0%</span>
                            </div>
                            <div id="slopeBar" class="factor-contribution slope-factor" style="width: 0%"></div>
                        </div>
                        <div class="mb-2">
                            <div class="flex justify-between mb-1">
                                <span>Edge Proximity</span>
                                <span id="edgeContrib">0%</span>
                            </div>
                            <div id="edgeBar" class="factor-contribution edge-factor" style="width: 0%"></div>
                        </div>
                        <div class="mt-4 pt-2 border-t text-center text-sm">
                            <p>Plus interaction effects between factors</p>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-6">
                    <p class="text-sm italic">ECERI enhances traditional REBA assessments by incorporating height-specific contextual factors.</p>
                    <p class="text-sm mt-2">© UTSA Research</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Update displayed values when sliders change
            document.getElementById('reba').addEventListener('input', function() {
                document.getElementById('rebaValue').textContent = this.value;
            });
            
            document.getElementById('height').addEventListener('input', function() {
                document.getElementById('heightValue').textContent = this.value + 'm';
            });
            
            document.getElementById('slope').addEventListener('input', function() {
                document.getElementById('slopeValue').textContent = this.value + '°';
            });
            
            document.getElementById('edgeDist').addEventListener('input', function() {
                document.getElementById('edgeDistValue').textContent = this.value + 'm';
            });
            
            // Calculate ECERI when button is clicked
            document.getElementById('calculate').addEventListener('click', calculateECERI);
            
            // Initial calculation
            calculateECERI();
            
            function calculateECERI() {
                // Get input values
                const reba = parseFloat(document.getElementById('reba').value);
                const height = parseFloat(document.getElementById('height').value);
                const surface = parseFloat(document.querySelector('input[name="surface"]:checked').value);
                const slope = parseFloat(document.getElementById('slope').value);
                const edgeDist = parseFloat(document.getElementById('edgeDist').value);
                
                // Constants from ECERI model
                const h_max = 30;  // Maximum reference height in meters
                const s_max = 3;   // Maximum surface rating
                const theta_max = 45;  // Maximum reference angle in degrees
                const d_max = 3;   // Maximum reference distance in meters
                
                const alpha = 0.8;  // Height scaling parameter
                const beta = 1.2;   // Slope scaling parameter
                const gamma = 0.7;  // Edge distance scaling parameter
                
                // Calculate normalized factors
                const hf = Math.min(1, Math.pow(height/h_max, alpha));
                const sf = surface/s_max;
                const slf = Math.min(1, Math.pow(slope/theta_max, beta));
                const epf = Math.max(0, 1 - Math.pow(edgeDist/d_max, gamma));
                
                // Define weights
                const w1 = 0.30;  // Height Factor weight
                const w2 = 0.20;  // Surface Factor weight
                const w3 = 0.30;  // Slope Factor weight
                const w4 = 0.20;  // Edge Proximity Factor weight
                
                // Interaction weights
                const w12 = 0.05;  // HF x SF interaction
                const w13 = 0.10;  // HF x SLF interaction
                const w24 = 0.05;  // SF x EPF interaction
                
                // Calculate amplification factor with normalization
                const amplification = (w1*hf + w2*sf + w3*slf + w4*epf + 
                                     w12*hf*sf + w13*hf*slf + w24*sf*epf) / 3.0;
                
                // Calculate ECERI
                const eceri = reba * (1 + amplification);
                
                // Calculate component contributions
                const components = {
                    HF_contrib: w1*hf / 3.0,
                    SF_contrib: w2*sf / 3.0,
                    SLF_contrib: w3*slf / 3.0,
                    EPF_contrib: w4*epf / 3.0,
                    HF_SF_contrib: w12*hf*sf / 3.0,
                    HF_SLF_contrib: w13*hf*slf / 3.0,
                    SF_EPF_contrib: w24*sf*epf / 3.0
                };
                
                // Display results
                document.getElementById('rebaScore').textContent = reba.toFixed(1);
                document.getElementById('eceriScore').textContent = eceri.toFixed(1);
                
                // Determine risk categories
                const rebaCategory = getRiskCategory(reba);
                const eceriCategory = getRiskCategory(eceri);
                
                document.getElementById('rebaCategory').textContent = rebaCategory;
                document.getElementById('eceriCategory').textContent = eceriCategory;
                
                // Set category colors
                setRiskCategoryColor('rebaCategory', rebaCategory);
                setRiskCategoryColor('eceriCategory', eceriCategory);
                
                // Update amplification gauge
                const amplificationPercent = amplification * 100;
                document.getElementById('amplificationGauge').style.width = Math.min(amplificationPercent * 2.5, 100) + '%';
                document.getElementById('amplificationValue').textContent = amplificationPercent.toFixed(1) + '%';
                
                // Update factor contributions
                document.getElementById('heightContrib').textContent = (components.HF_contrib * 100).toFixed(1) + '%';
                document.getElementById('surfaceContrib').textContent = (components.SF_contrib * 100).toFixed(1) + '%';
                document.getElementById('slopeContrib').textContent = (components.SLF_contrib * 100).toFixed(1) + '%';
                document.getElementById('edgeContrib').textContent = (components.EPF_contrib * 100).toFixed(1) + '%';
                
                document.getElementById('heightBar').style.width = (components.HF_contrib * 300) + '%';
                document.getElementById('surfaceBar').style.width = (components.SF_contrib * 300) + '%';
                document.getElementById('slopeBar').style.width = (components.SLF_contrib * 300) + '%';
                document.getElementById('edgeBar').style.width = (components.EPF_contrib * 300) + '%';
            }
            
            function getRiskCategory(score) {
                score = Math.round(score);
                if (score === 1) return "Negligible";
                if (score >= 2 && score <= 3) return "Low";
                if (score >= 4 && score <= 7) return "Medium";
                if (score >= 8 && score <= 10) return "High";
                return "Very High";
            }
            
            function setRiskCategoryColor(elementId, category) {
                const element = document.getElementById(elementId);
                element.className = ''; // Clear existing classes
                
                switch (category) {
                    case 'Negligible':
                        element.classList.add('risk-negligible', 'rounded', 'py-1');
                        break;
                    case 'Low':
                        element.classList.add('risk-low', 'rounded', 'py-1');
                        break;
                    case 'Medium':
                        element.classList.add('risk-medium', 'rounded', 'py-1');
                        break;
                    case 'High':
                        element.classList.add('risk-high', 'rounded', 'py-1');
                        break;
                    case 'Very High':
                        element.classList.add('risk-very-high', 'rounded', 'py-1');
                        break;
                }
            }
        });
    </script>
</body>
</html>
